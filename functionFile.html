<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Function File</title>

  <!-- Biblioteka Office.js do interakcji z Outlook/Office -->
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <script>
    // Funkcja wywoływana przez zdarzenie OnNewMessageCompose
    function handleNewMessageCompose(event) {
      // 1. Pobierz podstawowe dane użytkownika z Office.context.mailbox.userProfile
      const userProfile = Office.context.mailbox.userProfile;
      const displayName = userProfile.displayName || "Imię i Nazwisko";
      const emailAddress = userProfile.emailAddress || "adres@domena.com";

      // 2. Jeśli chcesz tu wstawić stanowisko/telefony, możesz na sztywno, pobrać z configu itd.
      const jobTitle = "Stanowisko"; 
      const phone = "123 456 789";
      const mobile = "987 654 321";

      // 3. Przygotuj HTML stopki
      const signatureHtml = `
        <br><br>
        <div style="font-family: Calibri, sans-serif; font-size: 10pt;">
          <strong>${displayName}</strong><br />
          ${jobTitle}<br />
          Tel: ${phone}, Kom: ${mobile}<br />
          E-mail: <a href="mailto:${emailAddress}">${emailAddress}</a>
        </div>
        <br>
      `;

      // 4. Wstaw stopkę na początku (prependAsync) ciała wiadomości
      Office.context.mailbox.item.body.prependAsync(
        signatureHtml,
        { coercionType: Office.CoercionType.Html },
        function(asyncResult) {
          // Po wstawieniu stopki musimy powiadomić Outlook, że zakończyliśmy operację
          event.completed();
        }
      );
    }

    // Office.initialize - wywoływane, gdy biblioteka Office.js jest gotowa
    Office.initialize = function () {
      // W przypadku zdarzeń event-based, najważniejsze jest mieć funkcję handleNewMessageCompose w globalnym scope
      // i wywołanie event.completed() na końcu.
    };
  </script>
</head>
<body>
  <p>Plik functionFile dla dodatku Outlook (OnNewMessageCompose).</p>
</body>
</html>
